<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jalsah Salanah - Kata-kata Jalsah Display</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4fc3f7, #e1f5fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            border-radius: 50px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #00c853, #64dd17);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
        }

        .counter {
            font-size: 0.85rem;
            text-align: center;
            color: #4fc3f7;
        }

        .quotes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }

        .quote-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            transition: transform 0.3s;
        }

        .quote-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
        }

        .quote-text {
            font-size: 1.4rem;
            line-height: 1.6;
            margin-bottom: 25px;
            font-style: italic;
            padding-left: 20px;
            border-left: 3px solid #4fc3f7;
        }

        .author-info {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
        }

        .author-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #e1f5fe;
        }

        .author-details {
            font-size: 0.95rem;
            opacity: 0.8;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .author-details span {
            background: rgba(79, 195, 247, 0.15);
            padding: 4px 12px;
            border-radius: 15px;
        }

        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px;
            font-size: 1.5rem;
            color: #4fc3f7;
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #e1f5fe;
        }

        @media (max-width: 768px) {
            .quotes-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                top: 10px;
                right: 10px;
                left: 10px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="refresh-btn" onclick="fetchQuotes()">⟳ Refresh</button>
        <div class="counter">Quotes: <span id="quote-count">0</span></div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>✨ Kata-kata Jalsah Salanah ✨</h1>
            <h2>Kumpulan Pesan dan Harapan dari Para Peserta</h2>
        </div>
        
        <div id="quotes-container" class="quotes-container">
            <div class="loading">Memuat kata-kata Jalsah...</div>
        </div>
    </div>

    <script>
        // ================= CONFIGURATION =================
        // REPLACE THESE VALUES WITH YOUR ACTUAL AIRTABLE DETAILS
        const CONFIG = {
            AIRTABLE_ACCESS_TOKEN: 'patts6tVnY59MqMmZ.fc9a33c522ec115155a56dc9adf119b7819c57430436f0b17f92a607428e50dc', // Get from Airtable Developer Hub
            AIRTABLE_BASE_ID: 'appvX87fdFqRidnl8', // Find in your Airtable base URL (app...)
            TABLE_NAME: 'Table 1', // Your table name exactly as shown in Airtable
            
            // Display settings
            REFRESH_INTERVAL: 30000, // 30 seconds
            
            // Filter: Only show approved quotes that aren't empty
            // Uses your exact field names: Approved and Kata-kata Jalsah
            FILTER_FORMULA: "AND({Approved}, {Kata-kata Jalsah}!='')"
        };

        // ================= MAIN FUNCTIONS =================
        async function fetchQuotes() {
            const container = document.getElementById('quotes-container');
            
            try {
                // Build the API URL - NO SORT PARAMETER (removed "Created" field)
                const encodedTableName = encodeURIComponent(CONFIG.TABLE_NAME);
                const encodedFilter = encodeURIComponent(CONFIG.FILTER_FORMULA);
                
                // URL WITHOUT sort parameter that was causing the error
                const url = `https://api.airtable.com/v0/${CONFIG.AIRTABLE_BASE_ID}/${encodedTableName}?filterByFormula=${encodedFilter}`;
                
                console.log("DEBUG: Fetching from URL:", url); // Helpful for debugging
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${CONFIG.AIRTABLE_ACCESS_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Handle empty results
                if (!data.records || data.records.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>Belum Ada Kata-kata yang Disetujui</h3>
                            <p>Kata-kata Jalsah akan muncul di sini setelah disetujui oleh panitia.</p>
                        </div>
                    `;
                    document.getElementById('quote-count').textContent = '0';
                    return;
                }
                
                // Display quotes
                container.innerHTML = '';
                
                data.records.forEach((record) => {
                    const fields = record.fields;
                    
                    const quoteCard = document.createElement('div');
                    quoteCard.className = 'quote-card';
                    
                    const kataKata = fields['Kata-kata Jalsah'] || '';
                    const nama = fields['Nama'] || 'Anonymous';
                    const tanzeem = fields['Tanzeem'] || '';
                    const muqami = fields['Muqami'] || '';
                    
                    quoteCard.innerHTML = `
                        <div class="quote-text">
                            "${escapeHtml(kataKata)}"
                        </div>
                        <div class="author-info">
                            <div class="author-name">${escapeHtml(nama)}</div>
                            <div class="author-details">
                                ${tanzeem ? `<span>${escapeHtml(tanzeem)}</span>` : ''}
                                ${muqami ? `<span>${escapeHtml(muqami)}</span>` : ''}
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(quoteCard);
                });
                
                // Update quote count
                document.getElementById('quote-count').textContent = data.records.length;
                
            } catch (error) {
                console.error('Error fetching quotes:', error);
                
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error Memuat Data</h3>
                        <p>${escapeHtml(error.message)}</p>
                        <p style="margin-top: 15px; font-size: 0.9rem;">
                            Periksa: 1) Token & Base ID, 2) Koneksi internet, 3) Nama tabel "Table 1"
                        </p>
                    </div>
                `;
            }
        }

        // Helper: Escape HTML to prevent XSS
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-refresh setup
        function setupAutoRefresh() {
            // Initial fetch
            fetchQuotes();
            
            // Set up interval for auto-refresh
            setInterval(fetchQuotes, CONFIG.REFRESH_INTERVAL);
        }

        // Fullscreen function
        function enterFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F11' || e.key === 'f') {
                e.preventDefault();
                enterFullscreen();
            }
            if (e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                fetchQuotes();
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', setupAutoRefresh);
    </script>
</body>
</html>
